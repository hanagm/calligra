From 6951e1e9b2d4439c83f385b354d246bd24e53ce3 Mon Sep 17 00:00:00 2001
From: Andrew den Exter <andrew.den.exter@qinetic.com.au>
Date: Mon, 14 Oct 2019 08:39:21 +0000
Subject: [PATCH 2/3] Don't double format spreadsheet currency values with
 custom format strings.

---
 sheets/ValueFormatter.cpp | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/sheets/ValueFormatter.cpp b/sheets/ValueFormatter.cpp
index 66914b1..2f2d703 100644
--- a/sheets/ValueFormatter.cpp
+++ b/sheets/ValueFormatter.cpp
@@ -330,7 +330,11 @@ QString ValueFormatter::createNumberFormat(Number value, int precision,
         break;
     case Format::Money:
         // There is no substitute for this in QLocale (toCurrencyString cannot set precision) :(
-        localizedNumber = m_converter->settings()->locale()->formatMoney(val, currencySymbol.isEmpty() ? m_converter->settings()->locale()->currencySymbol() : currencySymbol, p);
+        if (_formatString.isEmpty()) {
+            localizedNumber = m_converter->settings()->locale()->formatMoney(val, currencySymbol, p);
+        } else {
+            localizedNumber = m_converter->settings()->locale()->formatNumber(val, p);
+        }
         break;
     case Format::Scientific: {
         const QString decimalSymbol = m_converter->settings()->locale()->decimalSymbol();
-- 
1.8.3-rc3

